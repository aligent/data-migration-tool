<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * Copyright Â© 2016 Magento. All rights reserved.
 * See COPYING.txt for license details.
 */
-->
<map xmlns:xs="http://www.w3.org/2001/XMLSchema-instance" xs:noNamespaceSchemaLocation="../map.xsd">
    <source>
        <document_rules>
            <rename>
                <document>sales_flat_order</document>
                <to>sales_order</to>
            </rename>
            <rename>
                <document>sales_flat_order_address</document>
                <to>sales_order_address</to>
            </rename>
            <rename>
                <document>sales_flat_order_item</document>
                <to>sales_order_item</to>
            </rename>
            <rename>
                <document>sales_flat_order_payment</document>
                <to>sales_order_payment</to>
            </rename>
        </document_rules>
        <field_rules>
            <!-- custom SALES ORDER PAYMENT -->
            <move>
                <field>sales_flat_order_payment.cc_last4</field>
                <to>sales_order_payment.cc_last_4</to>
            </move>
            <ignore>
                <field>sales_flat_order_payment.paybox_request_number</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.ideal_transaction_checked</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.cybersource_token</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.ideal_issuer_title</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.paybox_question_number</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.ideal_issuer_id</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.flo2cash_account_id</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.amount</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.cc_raw_request</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.cc_raw_response</field>
            </ignore>
            <ignore>
                <field>sales_flat_order_payment.customer_payment_id</field>
            </ignore>

            <transform>
                <field>sales_flat_order_payment.parent_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver">
                    <param name="relatedKey" value="sales_flat_order.entity_id"/>
                </handler>
            </transform>
            <transform>
                <field>sales_flat_order_payment.entity_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver" />
            </transform>


            <!-- custom SALES ORDER ADDRESS -->

            <transform>
                <field>sales_flat_order_address.entity_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver" />
            </transform>
            <transform>
                <field>sales_flat_order_address.store_id</field>
                <handler class="\Migration\Handler\Convert" >
                    <param name="map" value="[1:3;3:3;6:7]"/>
                </handler>
            </transform>
            <transform>
                <field>sales_flat_order_address.parent_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver">
                    <param name="relatedKey" value="sales_flat_order.entity_id"/>
                </handler>
            </transform>
            <transform>
                <field>sales_flat_order_address.customer_address_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver">
                    <param name="relatedKey" value="customer_address_entity.entity_id"/>
                </handler>
            </transform>
            <transform>
                <field>sales_flat_order_address.customer_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver">
                    <param name="relatedKey" value="customer_entity.entity_id"/>
                </handler>
            </transform>
            <!-- custom SALES ORDER ITEM -->
            <move>
                <field>sales_flat_order_item.hidden_tax_amount</field>
                <to>sales_order_item.discount_tax_compensation_amount</to>
            </move>
            <move>
                <field>sales_flat_order_item.base_hidden_tax_amount</field>
                <to>sales_order_item.base_discount_tax_compensation_amount</to>
            </move>
            <move>
                <field>sales_flat_order_item.hidden_tax_invoiced</field>
                <to>sales_order_item.discount_tax_compensation_invoiced</to>
            </move>
            <move>
                <field>sales_flat_order_item.base_hidden_tax_invoiced</field>
                <to>sales_order_item.base_discount_tax_compensation_invoiced</to>
            </move>
            <move>
                <field>sales_flat_order_item.hidden_tax_refunded</field>
                <to>sales_order_item.discount_tax_compensation_refunded</to>
            </move>
            <move>
                <field>sales_flat_order_item.base_hidden_tax_refunded</field>
                <to>sales_order_item.base_discount_tax_compensation_refunded</to>
            </move>
            <move>
                <field>sales_flat_order_item.hidden_tax_canceled</field>
                <to>sales_order_item.discount_tax_compensation_canceled</to>
            </move>

            <!-- custom SALES FLAT ORDER-->
            <ignore>
                <field>sales_flat_order.onestepcheckout_customerfeedback</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.forced_do_shipment_with_invoice</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.payment_authorization_expiration</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.base_shipping_hidden_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.onestepcheckout_customercomment</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.utm_tracking_id</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.navconnect_dimension_value_1</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.navconnect_dimension_value_2</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.navconnect_id</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.navconnect_last_request_at</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.google_trusted_status</field>
            </ignore>

            <transform>
                <field>sales_flat_order.entity_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver" />
            </transform>
            <transform>
                <field>sales_flat_order.increment_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver" />
            </transform>
            <transform>
                <field>sales_flat_order.store_id</field>
                <handler class="\Migration\Handler\Convert" >
                    <param name="map" value="[1:3;3:3;6:7]"/>
                </handler>
            </transform>
            <transform>
                <field>sales_flat_order.customer_id</field>
                <handler class="\Migration\Handler\ExistingDataSupport\EntityIdResolver">
                    <param name="relatedKey" value="customer_entity.entity_id"/>
                </handler>
            </transform>
            <!-- end custom -->

            <ignore>
                <field>sales_flat_order.reward_points_balance_refunded</field>
            </ignore>
            <ignore>
                <field>sales_flat_order.reward_salesrule_points</field>
            </ignore>
            <move>
                <field>sales_flat_order.hidden_tax_amount</field>
                <to>sales_order.discount_tax_compensation_amount</to>
            </move>
            <move>
                <field>sales_flat_order.base_hidden_tax_amount</field>
                <to>sales_order.base_discount_tax_compensation_amount</to>
            </move>
            <move>
                <field>sales_flat_order.shipping_hidden_tax_amount</field>
                <to>sales_order.shipping_discount_tax_compensation_amount</to>
            </move>
            <move>
                <field>sales_flat_order.hidden_tax_invoiced</field>
                <to>sales_order.discount_tax_compensation_invoiced</to>
            </move>
            <move>
                <field>sales_flat_order.base_hidden_tax_invoiced</field>
                <to>sales_order.base_discount_tax_compensation_invoiced</to>
            </move>
            <move>
                <field>sales_flat_order.hidden_tax_refunded</field>
                <to>sales_order.discount_tax_compensation_refunded</to>
            </move>
            <move>
                <field>sales_flat_order.base_hidden_tax_refunded</field>
                <to>sales_order.base_discount_tax_compensation_refunded</to>
            </move>
        </field_rules>
    </source>
    <destination>
        <field_rules>
            <!-- custom -->
            <ignore>
                <field>sales_order.base_customer_balance_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.customer_balance_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.base_customer_balance_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.customer_balance_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.base_customer_balance_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.customer_balance_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.bs_customer_bal_total_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.customer_bal_total_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gift_cards</field>
            </ignore>
            <ignore>
                <field>sales_order.base_gift_cards_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gift_cards_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.base_gift_cards_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gift_cards_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.base_gift_cards_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gift_cards_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_id</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_allow_gift_receipt</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_add_card</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_base_price</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_price</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_base_price</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_price</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_base_price</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_price</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_base_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_base_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_base_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_base_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_base_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_base_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_base_tax_amount_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_tax_amount_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_base_tax_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_tax_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_base_tax_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_tax_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_base_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_base_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_base_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_base_tax_amount_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_tax_amount_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_base_tax_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_tax_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_base_tax_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_tax_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.reward_points_balance</field>
            </ignore>
            <ignore>
                <field>sales_order.base_reward_currency_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.reward_currency_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.base_rwrd_crrncy_amt_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.rwrd_currency_amount_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order.base_rwrd_crrncy_amnt_refnded</field>
            </ignore>
            <ignore>
                <field>sales_order.rwrd_crrncy_amnt_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order.reward_points_balance_refund</field>
            </ignore>
            <ignore>
                <field>sales_order_address.giftregistry_item_id</field>
            </ignore>
            <ignore>
                <field>sales_order_item.qty_returned</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_id</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_base_price</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_price</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_base_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_tax_amount</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_base_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_price_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_base_tax_amount_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_tax_amount_invoiced</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_base_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_price_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_base_tax_amount_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order_item.gw_tax_amount_refunded</field>
            </ignore>
            <ignore>
                <field>sales_order_item.event_id</field>
            </ignore>
            <ignore>
                <field>sales_order_item.giftregistry_item_id</field>
            </ignore>

            <!-- custom, not CE -->
            <ignore>
                <field>sales_order.forced_shipment_with_invoice</field>
            </ignore>
            <ignore>
                <field>sales_order.payment_auth_expiration</field>
            </ignore>
            <ignore>
                <field>sales_order.base_shipping_hidden_tax_amnt</field>
            </ignore>
            <ignore>
                <field>sales_order.newsletter_signup</field>
            </ignore>
            <ignore>
                <field>sales_order.osc_order_comment</field>
            </ignore>
            <ignore>
                <field>sales_order.osc_gift_wrap_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.base_osc_gift_wrap_amount</field>
            </ignore>
            <ignore>
                <field>sales_order.gift_wrap_type</field>
            </ignore>
            <ignore>
                <field>sales_order.osc_delivery_time</field>
            </ignore>

            <ignore>
                <field>sales_order.base_shipping_discount_tax_compensation_amnt</field>
            </ignore>

            <!-- end custom -->

            <!-- custom SALES ORDER ADDRESS -->
            <ignore>
                <field>sales_order_address.vat_id</field>
            </ignore>
            <ignore>
                <field>sales_order_address.vat_is_valid</field>
            </ignore>
            <ignore>
                <field>sales_order_address.vat_is_valid</field>
            </ignore>
            <ignore>
                <field>sales_order_address.vat_request_id</field>
            </ignore>
            <ignore>
                <field>sales_order_address.vat_request_date</field>
            </ignore>
            <ignore>
                <field>sales_order_address.vat_request_success</field>
            </ignore>
            <ignore>
                <field>sales_order_address.giftregistry_item_id</field>
            </ignore>

            <ignore>
                <field>sales_order.send_email</field>
            </ignore>
            <ignore>
                <field>sales_order.coupon_rule_name</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_base_price_incl_tax</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_price_incl_tax</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_base_price_incl_tax</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_items_price_incl_tax</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_base_price_incl_tax</field>
            </ignore>
            <ignore>
                <field>sales_order.gw_card_price_incl_tax</field>
            </ignore>
        </field_rules>
    </destination>
</map>
